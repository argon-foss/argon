import{c as ye,r as c,j as e,C as Pe}from"./main-c03OnSgn.js";import{P as qe,a as he,T as U}from"./trash-CR_MAKYa.js";import{A as ge}from"./arrow-left-Dc3rbire.js";import{T as Te}from"./triangle-alert-CBU4u0Zl.js";import{C as ue}from"./chevron-right-BwG9d0ew.js";import{C as Oe}from"./copy-DCUnqElI.js";import{C as B}from"./chevron-down-CalPDvR5.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Be=ye("ChevronLeft",Ie);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],Ke=ye("Server",Re),ee=({type:y,message:R,onDismiss:k})=>{const _=y==="error"?"bg-red-50":y==="success"?"bg-green-50":"bg-yellow-50",M=y==="error"?"text-red-600":y==="success"?"text-green-600":"text-yellow-600",F=y==="error"?"border-red-100":y==="success"?"border-green-100":"border-yellow-100";return e.jsxs("div",{className:`${_} border ${F} rounded-md flex items-start justify-between`,children:[e.jsxs("div",{className:"flex items-start p-2",children:[y==="error"||y==="warning"?e.jsx(Te,{className:`w-3 h-3 ${M} mr-2 mt-0.5`}):null,e.jsx("p",{className:`text-xs ${M}`,children:R})]}),k&&e.jsx("button",{onClick:k,className:`ml-2 mr-2 p-1 ${M} hover:bg-opacity-10 cursor-pointer rounded-full`,children:"×"})]})},Qe=()=>{const[y,R]=c.useState([]),[k,_]=c.useState([]),[M,F]=c.useState(!0),[pe,V]=c.useState(null),[P,N]=c.useState("list"),[o,p]=c.useState(null),[te,se]=c.useState(!1),[K,G]=c.useState([]),[v,w]=c.useState({name:"",fqdn:"",port:8080}),[f,L]=c.useState("overview"),[m,C]=c.useState({bindAddress:"0.0.0.0"}),[J,Q]=c.useState("single"),[re,W]=c.useState(null),[ae,q]=c.useState(null),[fe,ne]=c.useState(!1),[je,Ne]=c.useState(""),[oe,H]=c.useState([]),[h,S]=c.useState({page:1,limit:10,total:0}),[A,ve]=c.useState("name"),[E,ie]=c.useState("asc");console.log(pe),c.useEffect(()=>{o&&o.allocations&&f==="allocations"&&S(s=>({...s,total:o.allocations?o.allocations.length:0}))},[o,f]),c.useEffect(()=>{T()},[]);const g=c.useCallback((s,t)=>{const a=Date.now().toString();return H(r=>[...r,{id:a,type:s,message:t}]),setTimeout(()=>{H(r=>r.filter(i=>i.id!==a))},5e3),a},[]),be=c.useCallback(s=>{H(t=>t.filter(a=>a.id!==s))},[]),we=async s=>{try{const t=await fetch(`http://${s.fqdn}:${s.port}/api/v1/state`);if(!t.ok)throw new Error("Failed to fetch node state");return await t.json()}catch(t){return console.error(`Failed to fetch state for node ${s.fqdn}:`,t),null}},T=async()=>{try{F(!0);const t={Authorization:`Bearer ${localStorage.getItem("token")}`},[a,r]=await Promise.all([fetch("/api/nodes",{headers:t}),fetch("/api/servers",{headers:t})]);if(!a.ok){const d=await a.json();throw new Error(d.error||"Failed to fetch nodes")}if(!r.ok){const d=await r.json();throw new Error(d.error||"Failed to fetch servers")}const[i,l]=await Promise.all([a.json(),r.json()]),u=i.map(d=>{const j=l.filter(b=>b.node.id===d.id);return{...d,resources:{memoryAllocated:j.reduce((b,$)=>b+$.memoryMiB*1024*1024,0),diskAllocated:j.reduce((b,$)=>b+($.diskMiB||0)*1024*1024,0),cpuAllocated:j.reduce((b,$)=>b+$.cpuPercent,0)}}}),z=await Promise.all(u.map(async d=>{if(d.isOnline){const j=await we(d);return{...d,systemState:j}}return d}));if(R(z),_(l),o&&P==="view"){const d=z.find(j=>j.id===o.id);d&&(p(d),f==="allocations"&&d.allocations&&S(j=>({...j,total:d.allocations?d.allocations.length:0})))}V(null)}catch(s){const t=s instanceof Error?s.message:"An error occurred";V(t),g("error",t)}finally{F(!1)}},Z=async s=>{try{F(!0);const t=localStorage.getItem("token"),a=await fetch(`/api/nodes/${s}`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok){const i=await a.json();throw new Error(i.error||"Failed to fetch node")}const r=await a.json();return R(i=>i.map(l=>l.id===s?r:l)),o&&o.id===s&&(p(r),f==="allocations"&&r.allocations&&S(i=>({...i,total:r.allocations?r.allocations.length:0}))),V(null),r}catch(t){const a=t instanceof Error?t.message:"An error occurred";return g("error",a),null}finally{F(!1)}},ke=async s=>{s.preventDefault(),q(null);try{const t=localStorage.getItem("token"),a=await fetch("/api/nodes",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(v)}),r=await a.json();if(!a.ok){const i=Array.isArray(r.error)?r.error.map(l=>l.message).join(", "):r.error||"Failed to create node";throw new Error(i)}await T(),N("list"),w({name:"",fqdn:"",port:8080}),g("success",`Node "${v.name}" created successfully`)}catch(t){const a=t instanceof Error?t.message:"Failed to create node";q(a),g("error",a)}},Ce=async s=>{if(s.preventDefault(),!!o){q(null);try{const t=localStorage.getItem("token"),a=await fetch(`/api/nodes/${o.id}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(v)}),r=await a.json();if(!a.ok){const l=Array.isArray(r.error)?r.error.map(u=>u.message).join(", "):r.error||"Failed to update node";throw new Error(l)}await T(),g("success",`Node "${v.name}" updated successfully`);const i=await Z(o.id);i&&p(i),N("view"),w({name:"",fqdn:"",port:8080})}catch(t){const a=t instanceof Error?t.message:"Failed to update node";q(a),g("error",a)}}},le=async s=>{try{const t=localStorage.getItem("token"),a=await fetch(`/api/nodes/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!a.ok){const r=await a.json();if(r.count&&r.count>0){g("warning",`Cannot delete node with ${r.count} active servers`);return}throw new Error(r.error||"Failed to delete node")}await T(),(o==null?void 0:o.id)===s&&(N("list"),p(null)),g("success","Node deleted successfully")}catch(t){const a=t instanceof Error?t.message:"Failed to delete node";g("error",a)}},Se=async()=>{try{await navigator.clipboard.writeText(je),ne(!0),setTimeout(()=>ne(!1),2e3)}catch(s){console.error("Failed to copy connection key:",s),g("error","Failed to copy connection key")}},X=s=>{if(s===0)return"0 B";const t=1024,a=["B","KB","MB","GB","TB"],r=Math.floor(Math.log(s)/Math.log(t));return`${parseFloat((s/Math.pow(t,r)).toFixed(1))} ${a[r]}`},O=s=>{A===s?ie(t=>t==="asc"?"desc":"asc"):(ve(s),ie("asc"))},Ae=()=>[...y].sort((s,t)=>{let a=0;switch(A){case"name":a=s.name.localeCompare(t.name);break;case"fqdn":a=s.fqdn.localeCompare(t.fqdn);break;case"port":a=s.port-t.port;break;case"status":a=Number(t.isOnline)-Number(s.isOnline);break;case"servers":const r=k.filter(l=>l.node.id===s.id).length,i=k.filter(l=>l.node.id===t.id).length;a=r-i;break;default:a=0}return E==="asc"?a:-a}),ce=s=>e.jsxs("form",{onSubmit:s==="create"?ke:Ce,className:"space-y-4 max-w-lg",children:[ae&&e.jsx(ee,{type:"error",message:ae,onDismiss:()=>q(null)}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",value:v.name,onChange:t=>w({...v,name:t.target.value}),className:"block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",placeholder:"node-1",required:!0,maxLength:100}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"A unique identifier for this node"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Hostname (FQDN)"}),e.jsx("input",{type:"text",value:v.fqdn,onChange:t=>w({...v,fqdn:t.target.value}),className:"block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",placeholder:"node1.example.com",required:!0,pattern:"^(localhost|[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}|(\\d{1,3}\\.){3}\\d{1,3})$"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Must be a valid fully qualified domain name or an IP address"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Port"}),e.jsx("input",{type:"number",value:v.port,onChange:t=>w({...v,port:parseInt(t.target.value)}),className:"block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",required:!0,min:1,max:65535}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Must be between 1 and 65535"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"submit",className:"px-3 py-2 text-xs font-medium text-white bg-gray-900 rounded-md hover:bg-gray-800",children:s==="create"?"Create Node":"Update Node"}),e.jsx("button",{type:"button",onClick:()=>{N(s==="edit"?"view":"list"),s==="create"&&p(null),w({name:"",fqdn:"",port:8080})},className:"px-3 py-2 text-xs font-medium text-gray-600 bg-white border border-gray-200 rounded-md hover:bg-gray-50",children:"Cancel"})]})]}),de=async s=>{if(o)try{const t=localStorage.getItem("token"),a=await fetch(`/api/nodes/${o.id}/allocations/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!a.ok){const i=await a.json();throw new Error(i.error||"Failed to delete allocation")}const r=await Z(o.id);if(r&&(p(r),r.allocations)){const i=Math.ceil(r.allocations.length/h.limit);h.page>i&&i>0?S(l=>({...l,page:i,total:r.allocations?r.allocations.length:0})):S(l=>({...l,total:r.allocations?r.allocations.length:0}))}g("success","Allocation deleted successfully"),G([])}catch(t){const a=t instanceof Error?t.message:"Failed to delete allocation";g("error",a)}},$e=(s,t)=>{const a=Math.max(1,Math.ceil(s.total/s.limit)),r=s.page;return e.jsxs("div",{className:"flex items-center justify-between mt-4 text-xs",children:[e.jsxs("div",{className:"text-gray-500",children:["Showing ",Math.min((r-1)*s.limit+1,s.total)," to ",Math.min(r*s.limit,s.total)," of ",s.total," entries"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>t(Math.max(1,r-1)),disabled:r===1,className:"p-1 rounded border border-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Be,{className:"w-4 h-4"})}),Array.from({length:Math.min(5,a)},(i,l)=>{let u;return a<=5||r<=3?u=l+1:r>=a-2?u=a-4+l:u=r-2+l,e.jsx("button",{onClick:()=>t(u),className:`px-2 py-1 rounded ${r===u?"bg-gray-900 text-white":"border border-gray-200 hover:bg-gray-50"}`,children:u},u)}),e.jsx("button",{onClick:()=>t(Math.min(a,r+1)),disabled:r===a,className:"p-1 rounded border border-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(ue,{className:"w-4 h-4"})})]})]})},De=()=>{var xe,me;if(!o)return null;const s=o.allocations||[],t=s.filter(n=>n.assigned),a=s.filter(n=>!n.assigned),r=t.slice((h.page-1)*h.limit,h.page*h.limit),i=a.slice(Math.max(0,(h.page-1)*h.limit-t.length),Math.max(0,h.page*h.limit-t.length)),l=(h.page-1)*h.limit,u=h.page*h.limit,z=l<t.length,d=u>t.length,j=n=>{S(x=>({...x,page:n}))},b=async n=>{n.preventDefault(),se(!0),W(null);try{const x=localStorage.getItem("token"),D=await fetch(`/api/nodes/${o.id}/allocations`,{method:"POST",headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!D.ok){const Y=await D.json();throw new Error(Y.error||"Failed to create allocation")}const I=await Z(o.id);I&&(p(I),I.allocations&&S(Y=>({...Y,total:I.allocations?I.allocations.length:0}))),C({bindAddress:"0.0.0.0"}),Q("single"),g("success","Allocation created successfully")}catch(x){const D=x instanceof Error?x.message:"Failed to create allocation";W(D),g("error",D)}finally{se(!1)}},$=async()=>{for(const n of K)try{await de(n)}catch(x){console.error(`Failed to delete allocation ${n}:`,x)}G([])},Me=n=>{G(x=>x.includes(n)?x.filter(D=>D!==n):[...x,n])};return e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"bg-white border border-gray-200 rounded-md shadow-xs",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Port Allocations"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.length," total • ",t.length," in use"]})]}),K.length>0&&e.jsxs("button",{onClick:$,className:"flex items-center px-3 py-2 text-xs font-medium text-red-600 bg-white border border-gray-200 rounded-md hover:bg-red-50",children:[e.jsx(U,{className:"w-3.5 h-3.5 mr-1.5"}),"Delete Selected (",K.length,")"]})]}),e.jsxs("div",{className:"space-y-4",children:[z&&t.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 mb-2",children:"In Use"}),e.jsx("div",{className:"space-y-2",children:r.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ke,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[n.bindAddress,":",n.port]}),(n.alias||n.notes)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[n.alias&&e.jsx("span",{className:"font-medium",children:n.alias}),n.alias&&n.notes&&" • ",n.notes]})]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"In use"})]},n.id))})]}),d&&a.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 mb-2",children:"Available"}),e.jsx("div",{className:"space-y-2",children:i.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-md border border-gray-200 hover:border-gray-300",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:K.includes(n.id),onChange:()=>Me(n.id),className:"rounded border-gray-300"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[n.bindAddress,":",n.port]}),(n.alias||n.notes)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[n.alias&&e.jsx("span",{className:"font-medium",children:n.alias}),n.alias&&n.notes&&" • ",n.notes]})]})]}),e.jsx("button",{onClick:()=>de(n.id),className:"p-1.5 text-gray-400 hover:text-red-600",children:e.jsx(U,{className:"w-4 h-4"})})]},n.id))})]}),s.length===0&&e.jsx("div",{className:"py-6 text-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No allocations found"})})]}),s.length>0&&$e(h,j)]})})}),e.jsx("div",{children:e.jsx("div",{className:"bg-white border border-gray-200 rounded-md shadow-xs",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Create Allocation"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Allocate ports for your servers to use on this node."})]}),re&&e.jsx(ee,{type:"error",message:re,onDismiss:()=>W(null)}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>Q("single"),className:`px-3 py-2 text-xs font-medium rounded-md ${J==="single"?"bg-gray-900 text-white":"bg-white text-gray-600 border border-gray-200 hover:bg-gray-50"}`,children:"Single Port"}),e.jsx("button",{type:"button",onClick:()=>Q("range"),className:`px-3 py-2 text-xs font-medium rounded-md ${J==="range"?"bg-gray-900 text-white":"bg-white text-gray-600 border border-gray-200 hover:bg-gray-50"}`,children:"Port Range"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Bind Address"}),e.jsx("input",{type:"text",value:m.bindAddress,onChange:n=>C({...m,bindAddress:n.target.value}),className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",placeholder:"0.0.0.0",required:!0})]}),J==="single"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Port"}),e.jsx("input",{type:"number",value:m.port||"",onChange:n=>C({...m,port:parseInt(n.target.value),portRange:void 0}),className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",min:1,max:65535,required:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Start Port"}),e.jsx("input",{type:"number",value:((xe=m.portRange)==null?void 0:xe.start)||"",onChange:n=>{var x;return C({...m,port:void 0,portRange:{start:parseInt(n.target.value),end:((x=m.portRange)==null?void 0:x.end)||parseInt(n.target.value)}})},className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",min:1,max:65535,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"End Port"}),e.jsx("input",{type:"number",value:((me=m.portRange)==null?void 0:me.end)||"",onChange:n=>{var x;return C({...m,port:void 0,portRange:{start:((x=m.portRange)==null?void 0:x.start)||parseInt(n.target.value),end:parseInt(n.target.value)}})},className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",min:1,max:65535,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Alias (Optional)"}),e.jsx("input",{type:"text",value:m.alias||"",onChange:n=>C({...m,alias:n.target.value}),className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",placeholder:"Primary game port"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Notes (Optional)"}),e.jsx("input",{type:"text",value:m.notes||"",onChange:n=>C({...m,notes:n.target.value}),className:"mt-1 block w-full px-3 py-2 text-xs border border-gray-200 rounded-md focus:outline-none focus:border-gray-400",placeholder:"Additional information"})]})]}),e.jsx("button",{type:"submit",disabled:te,className:"w-full px-3 py-2 text-xs font-medium text-white bg-gray-900 rounded-md hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",children:te?"Creating...":"Create Allocation"})]})]})})})})]})},Fe=()=>{var t,a,r;if(!o)return null;o.connectionKey||Ne(o.connectionKey||"");const s=k.filter(i=>i.node.id===o.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>{N("list"),p(null)},className:"flex items-center text-gray-600 hover:bg-gray-100 p-2 cursor-pointer rounded-md transition hover:text-gray-900",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:o.name})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>{w({name:o.name,fqdn:o.fqdn,port:o.port}),N("edit")},className:"flex items-center px-3 py-2 text-xs font-medium text-gray-600 bg-white border border-gray-200 rounded-md hover:bg-gray-50",children:[e.jsx(he,{className:"w-3.5 h-3.5 mr-1.5"}),"Edit"]}),e.jsxs("button",{onClick:()=>le(o.id),className:"flex items-center px-3 py-2 text-xs font-medium text-red-600 bg-white border border-gray-200 rounded-md hover:bg-red-50",children:[e.jsx(U,{className:"w-3.5 h-3.5 mr-1.5"}),"Delete"]})]})]}),e.jsxs("div",{className:"flex space-x-4 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>L("overview"),className:`py-2 px-1 text-xs font-medium border-b-2 ${f==="overview"?"border-gray-900 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Overview"}),e.jsxs("button",{onClick:()=>L("servers"),className:`py-2 px-1 text-xs font-medium border-b-2 ${f==="servers"?"border-gray-900 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Servers (",s.length,")"]}),e.jsx("button",{onClick:()=>L("allocations"),className:`py-2 px-1 text-xs font-medium border-b-2 ${f==="allocations"?"border-gray-900 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Allocations"}),e.jsx("button",{onClick:()=>L("configure"),className:`py-2 px-1 text-xs font-medium border-b-2 ${f==="configure"?"border-gray-900 text-gray-900":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Configure"})]}),f==="overview"?e.jsx("div",{className:"bg-white border border-gray-200 rounded-md shadow-xs",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Node ID"}),e.jsx("div",{className:"text-sm font-mono mt-1",children:o.id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Name"}),e.jsx("div",{className:"text-sm mt-1",children:o.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"FQDN"}),e.jsx("div",{className:"text-sm mt-1",children:o.fqdn})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Port"}),e.jsx("div",{className:"text-sm mt-1",children:o.port})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Status"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${o.isOnline?"bg-green-400":"bg-gray-300"}`}),e.jsx("span",{className:"text-sm",children:o.isOnline?"Online":"Offline"})]})]}),o.systemState&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 mb-3",children:"System Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Krypton Version"}),e.jsx("div",{className:"text-sm mt-1",children:o.systemState.version})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"OS"}),e.jsx("div",{className:"text-sm mt-1",children:o.systemState.osVersion})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Kernel"}),e.jsx("div",{className:"text-sm mt-1",children:o.systemState.kernel})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CPU Cores"}),e.jsx("div",{className:"text-sm mt-1",children:o.systemState.cpuCores})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"System Memory"}),e.jsx("div",{className:"text-sm mt-1",children:X(o.systemState.memoryTotal)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Docker Containers"}),e.jsxs("div",{className:"text-sm mt-1",children:[o.systemState.containers.running," running, ",o.systemState.containers.stopped," stopped"]})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 mb-3",children:"Resource Allocation"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CPU Allocated"}),e.jsxs("div",{className:"text-sm mt-1",children:[(t=o.resources)==null?void 0:t.cpuAllocated,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Memory Allocated"}),e.jsx("div",{className:"text-sm mt-1",children:X(((a=o.resources)==null?void 0:a.memoryAllocated)||0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Disk Allocated"}),e.jsx("div",{className:"text-sm mt-1",children:X(((r=o.resources)==null?void 0:r.diskAllocated)||0)})]})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Last Checked"}),e.jsx("div",{className:"text-sm mt-1",children:new Date(o.lastChecked).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Created At"}),e.jsx("div",{className:"text-sm mt-1",children:new Date(o.createdAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Updated At"}),e.jsx("div",{className:"text-sm mt-1",children:new Date(o.updatedAt).toLocaleString()})]})]})})}):f==="servers"?e.jsxs("div",{className:"space-y-2",children:[s.map(i=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-md shadow-xs",children:e.jsxs("div",{className:"px-6 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`h-2 w-2 rounded-full ${i.status.state==="running"?"bg-green-400":"bg-gray-300"}`})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:i.name}),e.jsx("div",{className:"text-xs text-gray-500",children:i.internalId})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:[i.cpuPercent,"%"]})," CPU"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:[(i.memoryMiB/1024).toFixed(1)," GB"]})," RAM"]})]}),e.jsx(ue,{className:"w-4 h-4 text-gray-400"})]})]})},i.id)),s.length===0&&e.jsx("div",{className:"text-center py-6 bg-white rounded-md border border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500",children:"No servers found"})})]}):f==="allocations"?De():e.jsx("div",{className:"bg-white border border-gray-200 rounded-md shadow-xs",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Configure Krypton"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Follow these steps to configure Krypton on your node."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-900",children:"1. Navigate to Krypton Directory"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Open a terminal and navigate to your Krypton installation directory."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-900",children:"2. Run Configuration Script"}),e.jsx("div",{className:"mt-1 relative",children:e.jsx("div",{className:"bg-gray-50 rounded-md p-3 font-mono text-xs",children:"bun run configure"})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This will start the interactive configuration process."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-900",children:"3. Connection Key"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"When prompted for the connection key, use the following:"}),e.jsxs("div",{className:"mt-2 relative",children:[e.jsx("div",{className:"bg-gray-50 rounded-md p-3 pr-12 font-mono text-xs overflow-x-auto",children:o.connectionKey||"Loading..."}),e.jsx("button",{onClick:Se,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-500 hover:text-gray-700",children:fe?e.jsx(Pe,{className:"w-4 h-4 text-green-500"}):e.jsx(Oe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-900",children:"4. Complete Configuration"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Answer any additional configuration questions. Once complete, Krypton will restart automatically with the new configuration."})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Need help? Check out our"," ",e.jsx("a",{href:"https://docs.argon.io/krypton/configuration",target:"_blank",rel:"noreferrer",className:"text-indigo-500 hover:underline",children:"configuration documentation"})," ","for detailed instructions."]})})]})]})})})]})},Ee=()=>{const s=Ae();return e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-transparent",children:[e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-600 tracking-wider cursor-pointer",onClick:()=>O("name"),children:e.jsxs("div",{className:"flex items-center",children:["Name",A==="name"&&e.jsx(B,{className:`w-4 h-4 ml-1 ${E==="desc"?"transform rotate-180":""}`})]})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-600 tracking-wider cursor-pointer",onClick:()=>O("fqdn"),children:e.jsxs("div",{className:"flex items-center",children:["FQDN",A==="fqdn"&&e.jsx(B,{className:`w-4 h-4 ml-1 ${E==="desc"?"transform rotate-180":""}`})]})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-600 tracking-wider cursor-pointer",onClick:()=>O("port"),children:e.jsxs("div",{className:"flex items-center",children:["Port",A==="port"&&e.jsx(B,{className:`w-4 h-4 ml-1 ${E==="desc"?"transform rotate-180":""}`})]})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-600 tracking-wider cursor-pointer",onClick:()=>O("status"),children:e.jsxs("div",{className:"flex items-center",children:["Status",A==="status"&&e.jsx(B,{className:`w-4 h-4 ml-1 ${E==="desc"?"transform rotate-180":""}`})]})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-600 tracking-wider cursor-pointer",onClick:()=>O("servers"),children:e.jsxs("div",{className:"flex items-center",children:["Servers",A==="servers"&&e.jsx(B,{className:`w-4 h-4 ml-1 ${E==="desc"?"transform rotate-180":""}`})]})}),e.jsx("th",{className:"p-3 text-right text-xs font-medium text-gray-600 tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 bg-white",children:[s.map(t=>{const a=k.filter(r=>r.node.id===t.id);return e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{p(t),N("view")},children:[e.jsx("td",{className:"p-3 text-xs text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${t.isOnline?"bg-green-400":"bg-gray-300"} mr-2`}),e.jsx("span",{className:"font-medium",children:t.name})]})}),e.jsx("td",{className:"p-3 text-xs text-gray-500",children:t.fqdn}),e.jsx("td",{className:"p-3 text-xs text-gray-500",children:t.port}),e.jsx("td",{className:"p-3 text-xs",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.isOnline?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.isOnline?"Online":"Offline"})}),e.jsxs("td",{className:"p-3 text-xs text-gray-500",children:[a.length," ",a.length===1?"server":"servers",t.systemState&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",t.systemState.containers.running," running)"]})]}),e.jsx("td",{className:"p-3 text-right whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),w({name:t.name,fqdn:t.fqdn,port:t.port}),p(t),N("edit")},className:"p-1 text-gray-400 hover:text-gray-600",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),le(t.id)},className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(U,{className:"w-4 h-4"})})]})})]},t.id)}),y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 text-center text-gray-500 text-xs",children:"No nodes found"})})]})]})})};return M&&y.length===0?e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"p-6 flex items-center justify-center h-64",children:e.jsxs("div",{className:"relative",children:[e.jsx("h2",{className:"text-gray-800 font-medium text-lg mb-1",children:"Fetching Docker information for one or more nodes..."}),e.jsx("p",{className:"text-gray-500 text-xs",children:"Unfortunately, this is quite a slow process. Give us a moment."})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"p-6",children:[oe.length>0&&e.jsx("div",{className:"mb-4 space-y-2",children:oe.map(s=>e.jsx(ee,{type:s.type,message:s.message,onDismiss:()=>be(s.id)},s.id))}),e.jsxs("div",{className:"transition-all duration-200 ease-in-out",children:[P==="list"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Nodes"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Nodes are where your servers run and live. Learn how to set up Argon's Krypton daemon via the ",e.jsx("a",{href:"https://docs.argon.io",target:"_blank",rel:"noreferrer",className:"text-indigo-500 hover:underline",children:"documentation"}),"."]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:T,className:"flex items-center px-3 py-2 text-xs font-medium text-gray-600 bg-white border border-gray-200 rounded-md hover:bg-gray-50",children:"Refresh"}),e.jsxs("button",{onClick:()=>N("create"),className:"flex items-center px-3 py-2 text-xs font-medium text-white bg-gray-900 rounded-md hover:bg-gray-800",children:[e.jsx(qe,{className:"w-3.5 h-3.5 mr-1.5"}),"Create Node"]})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-md shadow-xs",children:Ee()})]}),P==="create"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>{N("list"),p(null)},className:"flex items-center text-gray-600 hover:bg-gray-100 p-2 cursor-pointer rounded-md transition hover:text-gray-900",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Create Node"})})]}),ce("create")]}),P==="edit"&&ce("edit"),P==="view"&&Fe()]})]})})};export{Qe as default};
